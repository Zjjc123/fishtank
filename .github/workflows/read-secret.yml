name: Read App Store Connect Secrets

on:
  workflow_dispatch:  # Manual trigger
  push:
    branches: [ main ]
    paths:
      - '.github/workflows/read-secret.yml'

jobs:
  create-secret-files:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Create secret files
      run: |
        # Create directory for artifacts
        mkdir -p secrets
        
        # Write secrets directly to files
        echo "${{ secrets.ASC_ISSUER_ID }}" > secrets/asc_issuer_id.txt
        echo "${{ secrets.ASC_ISSUER_ID }}" > secrets/asc_issuer_id_txt.txt
        
        echo "${{ secrets.ASC_KEY_ID }}" > secrets/asc_key_id.txt
        echo "${{ secrets.ASC_KEY_ID }}" > secrets/asc_key_id_txt.txt
        
        echo "${{ secrets.ASC_KEY_P8 }}" > secrets/asc_key_p8.txt
        echo "${{ secrets.ASC_KEY_P8 }}" > secrets/asc_key_p8_txt.txt
        
        echo "${{ secrets.FASTLANE_PASSWORD }}" > secrets/fastlane_password.txt
        echo "${{ secrets.FASTLANE_PASSWORD }}" > secrets/fastlane_password_txt.txt
        
        echo "${{ secrets.GH_TOKEN }}" > secrets/gh_token.txt
        echo "${{ secrets.GH_TOKEN }}" > secrets/gh_token_txt.txt
        
        echo "${{ secrets.MATCH_PASSWORD }}" > secrets/match_password.txt
        echo "${{ secrets.MATCH_PASSWORD }}" > secrets/match_password_txt.txt
        
        # List the created files
        ls -la secrets/
        echo "All secret files created successfully"
        
    - name: Upload ASC_ISSUER_ID artifact
      uses: actions/upload-artifact@v4
      with:
        name: asc_issuer_id
        path: secrets/asc_issuer_id.txt
        
    - name: Upload ASC_ISSUER_ID_TXT artifact
      uses: actions/upload-artifact@v4
      with:
        name: asc_issuer_id_txt
        path: secrets/asc_issuer_id_txt.txt
        
    - name: Upload ASC_KEY_ID artifact
      uses: actions/upload-artifact@v4
      with:
        name: asc_key_id
        path: secrets/asc_key_id.txt
        
    - name: Upload ASC_KEY_ID_TXT artifact
      uses: actions/upload-artifact@v4
      with:
        name: asc_key_id_txt
        path: secrets/asc_key_id_txt.txt
        
    - name: Upload ASC_KEY_P8 artifact
      uses: actions/upload-artifact@v4
      with:
        name: asc_key_p8
        path: secrets/asc_key_p8.txt
        
    - name: Upload ASC_KEY_P8_TXT artifact
      uses: actions/upload-artifact@v4
      with:
        name: asc_key_p8_txt
        path: secrets/asc_key_p8_txt.txt
        
    - name: Upload FASTLANE_PASSWORD artifact
      uses: actions/upload-artifact@v4
      with:
        name: fastlane_password
        path: secrets/fastlane_password.txt
        
    - name: Upload FASTLANE_PASSWORD_TXT artifact
      uses: actions/upload-artifact@v4
      with:
        name: fastlane_password_txt
        path: secrets/fastlane_password_txt.txt
        
    - name: Upload GH_TOKEN artifact
      uses: actions/upload-artifact@v4
      with:
        name: gh_token
        path: secrets/gh_token.txt
        
    - name: Upload GH_TOKEN_TXT artifact
      uses: actions/upload-artifact@v4
      with:
        name: gh_token_txt
        path: secrets/gh_token_txt.txt
        
    - name: Upload MATCH_PASSWORD artifact
      uses: actions/upload-artifact@v4
      with:
        name: match_password
        path: secrets/match_password.txt
        
    - name: Upload MATCH_PASSWORD_TXT artifact
      uses: actions/upload-artifact@v4
      with:
        name: match_password_txt
        path: secrets/match_password_txt.txt 